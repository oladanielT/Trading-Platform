# Live Trading Configuration - Conservative Activation
#
# This configuration activates all strategies with small positions and tight
# risk controls. Start with this configuration and gradually increase exposure
# only if paper/live performance matches backtested expectations.
#
# Design Principles:
# - Max 10% position per trade (strict)
# - Max 2% risk per trade (conservative)
# - All readiness gating and execution logic preserved
# - Paper mode allows safe testing before live activation
#

# Trading environment: paper, testnet, or live
environment: paper # START IN PAPER MODE - only change to "live" after paper validation

# Exchange configuration
exchange:
  id: binance
  testnet: true # Set to false only for live trading with real API keys

  # Binance API credentials - CHANGE THESE FOR LIVE
  api_key: "YOUR_LIVE_API_KEY_HERE"
  secret_key: "YOUR_LIVE_SECRET_KEY_HERE"

  # For live trading, use production URLs
  # testnet_url: "https://api.binance.com/api"
  # testnet_ws_url: "wss://stream.binance.com:9443/ws"

# Trading parameters
trading:
  # Multi-symbol portfolio
  symbols:
    - BTC/USDT # Primary pair
    - ETH/USDT
    - BNB/USDT
    - XRP/USDT
    - ADA/USDT

  # Default symbol
  symbol: BTC/USDT

  timeframe: 1h
  initial_capital: 100000.0 # ADJUST based on account size
  fetch_limit: 500

  # Multi-pair allocation - 20% per symbol, 100% total
  allocation_per_symbol: 0.2

# Strategy configuration - Multiple strategies activated
strategy:
  # Primary strategy: regime-based (gated on market conditions)
  name: regime_based

  # Underlying trend detection
  fast_period: 20
  slow_period: 50
  signal_confidence: 0.75

  # Regime restrictions - only trade in trending/quiet markets
  allowed_regimes:
    - trending
    - quiet
    - volatile

  regime_confidence_threshold: 0.5
  reduce_confidence_in_marginal_regimes: true

  # Volatile override - allow trending in volatile if strong
  allow_volatile_trend_override: true
  volatile_trend_strength_min: 1.0
  volatile_confidence_scale: 0.6

  # Multi-strategy aggregation
  multi_strategy:
    enabled: true
    strategies:
      - name: ema_trend
        enabled: true
        params:
          fast_period: 9
          slow_period: 21
          signal_confidence: 0.60
        weight: 0.3

      - name: continuation
        enabled: true
        params:
          min_impulse_pct: 1.5
          min_breakout_pct: 0.4
          require_trend_confirmation: false
        weight: 0.4

      - name: fvg
        enabled: true
        params:
          min_gap_size_pct: 0.25
          require_volume_spike: true
        weight: 0.3

    # Enable adaptive weighting based on performance
    adaptive_weighting:
      enabled: true
      learning_rate: 0.1
      min_samples: 20

# Risk management - CONSERVATIVE SETTINGS FOR LIVE TRADING
risk:
  # Position sizing constraints
  max_position_size: 0.1 # 10% of equity max per trade
  risk_per_trade: 0.02 # 2% risk per trade (conservative)
  sizing_method: fixed_risk # Use fixed risk sizing
  use_confidence_scaling: true # Scale positions by signal confidence

  # Drawdown protection - strict limits
  max_daily_drawdown: 0.05 # 5% max daily loss
  max_total_drawdown: 0.20 # 20% max total drawdown from peak
  max_consecutive_losses: 5 # Halt after 5 consecutive losses

  # Per-symbol risk limits (optional)
  per_symbol_max_position: 0.08 # Max 8% per symbol
  per_symbol_risk: 0.015 # Max 1.5% risk per symbol

# Execution settings
execution:
  order_timeout: 30 # 30 second order timeout
  max_retries: 3 # Retry orders up to 3 times
  retry_delay: 5 # 5 second delay between retries

  # Live trading specific
  check_balance: true # Verify balance before orders
  post_only: false # Set true for maker-only orders
  reduce_only: false # Don't set to true unless closing positions

# Monitoring and logging
monitoring:
  log_level: INFO # INFO=detailed, DEBUG=very detailed
  log_file: logs/live_trading.log
  metrics_enabled: true

  # Alert system
  runtime_alerts:
    enabled: true
    readiness_threshold: not_ready # Alert if readiness drops to "not_ready"
    confidence_threshold: 0.85 # Alert if confidence > 85% with reversal
    deviation_threshold: 0.3 # Alert if strategy deviates > 30% from aggregate

  # Performance monitoring
  performance:
    enabled: true
    equity_check_interval: 1h # Check equity every hour
    drawdown_warning_pct: 0.03 # Warn at 3% drawdown
    success_rate_target: 0.55 # Target 55% win rate
    readiness_correlation: true # Track readiness vs success

  # Logging detail
  log_trades: true # Log every trade
  log_signals: true # Log every signal generation
  log_positions: true # Log position updates
  log_alerts: true # Log all alerts

# Portfolio Risk Management - Phase 7 (OPTIONAL)
# ================================================
# Prevents correlated drawdowns and overexposure through:
# - Correlation-based position rejection
# - Symbol and directional exposure limits
# - Regime-based exposure balancing
# Safe by default: disabled until explicitly enabled
portfolio_risk:
  enabled: true # ENABLED: Prevent correlated crashes across multiple symbols

  # Correlation settings
  correlation_lookback: 100 # Bars for correlation calculation
  max_pairwise_correlation: 0.85 # Block if new position correlates > 85% with existing

  # Exposure limits (as % of total equity)
  max_symbol_exposure_pct: 0.25 # Max 25% capital per symbol
  max_directional_exposure_pct: 0.60 # Max 60% total long or short exposure
  max_regime_exposure_pct: 0.50 # Max 50% exposure per regime

# Regime-Aware Capital Allocation - Phase 8 (OPTIONAL)
# =====================================================
# Dynamically allocates capital across regimes based on performance:
# - Tracks performance per regime (trending, ranging, volatile)
# - Adjusts allocation multipliers based on win rate and PnL
# - Soft rebalancing: gradual shifts, no step changes
# - Never increases leverage: multipliers bounded [0.0, 1.0]
# Safe by default: disabled until explicitly enabled
regime_capital:
  enabled: false # Set to true to enable regime-aware capital allocation

  # Rebalancing settings
  rebalance_interval: 1h # How often to recompute allocations
  min_trades_before_adjustment: 20 # Minimum trades per regime before adjusting
  max_allocation_shift: 0.1 # Max change per rebalance (10% per shift)

  # Base allocation split (initial distribution across regimes)
  # Sum should be ≤ 1.0 to preserve risk constraints
  allocations:
    trending: 0.5 # 50% of available capital to trending regime
    ranging: 0.3 # 30% of available capital to ranging regime
    volatile: 0.2 # 20% of available capital to volatile regime

# Execution Reality & Market Impact - Phase 9 (OPTIONAL)
# =======================================================
# Makes execution realistic by modeling:
# - Slippage based on order size and volatility
# - Partial fill probability estimation
# - Liquidity constraints and order rejection
# - Latency impact assessment
#
# This layer ONLY applies downward pressure - never increases size.
# Disabled by default for zero behavioral change. Enable for realistic backtests.
#
# Design: Protects capital by reducing sizes in illiquid/volatile conditions.
# Never overrides portfolio or regime caps. Works alongside all existing gates.
execution_reality:
  enabled: false # Set to true to enable execution realism modeling

  # Liquidity constraint: max order size as % of recent candle volume
  # Example: 0.02 = don't place orders > 2% of recent hourly volume
  # Prevents slippage explosion on oversized orders
  max_size_vs_volume: 0.02

  # Fill probability threshold: reject orders unlikely to fill
  # Example: 0.6 = skip trades with <60% fill probability
  # Prevents chasing illiquid markets during volatility spikes
  min_fill_probability: 0.6

  # Slippage model: 'conservative' | 'moderate' | 'aggressive'
  # - conservative: high slippage estimates (pessimistic, safe)
  # - moderate: middle ground
  # - aggressive: low slippage estimates (optimistic, risky)
  # Recommendation: use 'conservative' for live trading, 'moderate' for backtesting
  slippage_model: conservative

  # Latency penalty: how much extra slippage to assume from latency (milliseconds)
  # Added on top of market impact slippage
  # Example: 500ms penalty for API/network latency
  latency_penalty_ms: 500

# PHASE 10: Offline Alpha Lab Configuration
# ==========================================
# This is an OFFLINE research laboratory - no live trading integration
# Used to discover and validate strategy edge before human promotion
alpha_lab:
  enabled: false # MUST BE MANUALLY ENABLED - never auto-activates

  # Walk-forward validation settings
  walk_forward:
    train_pct: 0.6 # 60% training window
    test_pct: 0.4 # 40% test window
    step_size: 0.1 # 10% rolling step
    min_train_samples: 100
    min_test_samples: 30

  # Robustness testing settings
  robustness:
    param_perturbation_range: 0.2 # ±20% parameter variations
    noise_level: 0.01 # 1% price jitter
    monte_carlo_runs: 500 # Monte Carlo simulations
    min_stability_score: 0.7 # 0-1 scale

  # Alpha qualification criteria (STRICT)
  qualification:
    min_expectancy: 0.0 # Must be positive
    min_sharpe: 1.2 # Minimum Sharpe ratio
    max_drawdown: 0.20 # 20% max drawdown
    min_robustness: 0.7 # Robustness score
    min_oos_consistency: 0.70 # 70% OOS consistency
    min_trades: 30 # Minimum sample size

  # Output directory for reports (relative to project root)
  reports_dir: alpha_reports

  # SAFETY: These settings have NO EFFECT on live trading
  # Alpha Lab is completely isolated from execution pipeline
# Activation stages (comments for phased rollout)
#
# STAGE 1 - PAPER MODE VALIDATION (this config, paper mode)
# =========================================================
# - Run with max_position_size: 0.1, risk_per_trade: 0.02
# - Monitor for 1-2 weeks minimum
# - Check: readiness accuracy, signal distribution, drawdown behavior
# - Verify alert system catches real anomalies
# - PASS CRITERIA: 50%+ win rate, drawdown < 2%, readiness matches expectations
#
# STAGE 2 - TESTNET VALIDATION (change environment to testnet)
# =============================================================
# - Run with same parameters in testnet mode
# - Monitor for 1 week with real exchange latency
# - Check: order fills, latency impact, slippage estimates
# - PASS CRITERIA: Similar metrics to paper, order fill rate > 95%
#
# STAGE 3 - LIVE MICRO POSITIONS (change environment to live, small capital)
# ============================================================================
# - Start with $1000-5000 initial capital
# - Run for 1-2 weeks
# - Monitor: real slippage, actual fills, fees impact
# - PASS CRITERIA: Consistent with paper/testnet, no unexpected slippage
#
# STAGE 4 - LIVE SCALING (increase capital gradually)
# ====================================================
# - After 2+ weeks successful live trading at micro level
# - Only increase capital if performance matches paper expectations
# - Increase by 50% per week: $5k → $7.5k → $10k → $15k
# - Can stop at any level or return to paper if performance drops
#
# STAGE 5 - PRODUCTION (full capital allocation)
# ================================================
# - After 4+ weeks at full capital with consistent performance
# - Consider increasing position size and risk limits
# - Can adjust thresholds based on observed regime behavior

# ==============================================================================
# PHASE 11: STRATEGY PROMOTION & CAPITAL GRADUATION
# ==============================================================================
# Human-in-the-loop governance for strategy deployment.
# Controls the transition from research to live trading with mandatory approval.

strategy_promotion:
  # Master switch - disable to prevent any promotion activity
  enabled: false # SAFETY: disabled by default

  # Require human approval for RESEARCH → APPROVED transition
  # WARNING: Never set to false - bypasses all safety checks
  require_human_approval: true # MANDATORY

  # Automatically demote underperforming strategies
  auto_demote: true

  # Approvals directory (file-based approval system)
  approvals_directory: "approvals"

  # Maximum capital allocation for MICRO_LIVE state
  # SAFETY: This is the initial allocation - cannot exceed 5% of portfolio
  max_micro_live_capital: 0.05 # 5% max for new strategies

  # Demotion criteria (automatic downgrade triggers)
  demotion_criteria:
    # Maximum allowed drawdown before auto-demotion
    max_drawdown: 0.15 # 15%

    # Minimum expectancy (avg profit per trade)
    min_expectancy: 0.0 # Must be profitable

    # Minimum win rate
    min_win_rate: 0.40 # 40%

    # Circuit breaker - consecutive losses
    max_consecutive_losses: 5

    # Minimum trades before evaluation
    min_trades_before_eval: 20

    # Maximum correlation with existing strategies
    max_correlation: 0.85

    # Consecutive regime mismatches before demotion
    regime_mismatch_threshold: 10

  # State-specific capital limits
  capital_limits:
    SHADOW: 0.0 # No capital - signal tracking only
    PAPER: 0.0 # No capital - paper trading only
    MICRO_LIVE: 0.05 # 5% of portfolio max
    FULL_LIVE: 1.0 # 100% subject to portfolio risk limits

  # Promotion evaluation schedule
  evaluation:
    # How often to check for pending approvals
    approval_check_interval: 300 # 5 minutes

    # How often to evaluate live strategies for demotion
    demotion_check_interval: 3600 # 1 hour

    # Minimum time in each state before promotion
    min_shadow_duration_hours: 24 # 1 day tracking
    min_paper_duration_hours: 168 # 1 week paper trading
    min_micro_live_duration_hours: 168 # 1 week at micro capital

  # Shadow execution settings
  shadow_execution:
    # Track signals without executing
    track_signals: true

    # Compare with live execution (when available)
    compare_with_live: true

    # Divergence alert threshold
    max_signal_divergence: 0.15 # 15% difference triggers alert

  # Logging and audit
  logging:
    log_all_decisions: true
    log_demotion_reasons: true
    log_approval_files: true
    audit_trail_directory: "logs/promotions"
